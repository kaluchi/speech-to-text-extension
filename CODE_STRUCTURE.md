# Структура кода расширения

Основная логика расширения разделена на несколько файлов для облегчения поддержки и развития.

## Основные компоненты

Исходный файл `content.js` был разделен на следующие модули:

1. **content-utils.js**
   - Вспомогательные функции общего назначения
   - Проверка знаков препинания, форматирование текста, определение типов файлов и т.д.

2. **content-settings.js**
   - Управление настройками расширения
   - Загрузка, сохранение и отслеживание изменений настроек
   - Проверка API ключа

3. **content-state.js**
   - Управление состоянием расширения (машина состояний)
   - Определение состояний (IDLE, PRESSED, RELEASED, HELD)
   - Функции для управления визуальным интерфейсом (маска записи)

4. **content-recorder-analysis.js**
   - Функции для анализа аудиоданных
   - Определение наличия звука в аудиозаписи
   - Вспомогательные функции для работы с аудио (воспроизведение, скачивание)

5. **content-recorder.js**
   - Функционал для записи аудио
   - Взаимодействие с микрофоном
   - Создание и управление MediaRecorder
   - Инициализация и управление процессом записи

6. **content-speechapi.js**
   - Взаимодействие с API распознавания речи (ElevenLabs API)
   - Формирование и отправка запросов
   - Обработка ответов API

7. **content-text.js**
   - Функции для работы с текстом
   - Вставка распознанного текста в различные типы полей ввода
   - Копирование текста в буфер обмена

8. **content-main.js**
   - Основные обработчики событий (нажатие клавиш)
   - Инициализация расширения
   - Обработка сообщений между content script и popup

## Порядок загрузки

Порядок загрузки файлов в `manifest.json` критически важен, поскольку некоторые файлы используют функции и переменные, определенные в других файлах:

```json
"js": [
  "localization.js",            // 1. Локализация (базовый функционал)
  "content-utils.js",           // 2. Утилиты (используются всеми остальными модулями)
  "content-settings.js",        // 3. Настройки (используются для конфигурации)
  "content-state.js",           // 4. Управление состоянием
  "content-recorder-analysis.js", // 5. Анализ аудио (используется для проверки записи)
  "content-recorder.js",        // 6. Запись аудио (зависит от настроек и состояния)
  "content-speechapi.js",       // 7. Взаимодействие с API (зависит от записи)
  "content-text.js",            // 8. Работа с текстом (зависит от результатов API)
  "content-main.js"             // 9. Основные обработчики (связывает все компоненты)
]
```

## Удаление старого файла

Файл `content.js` оставлен с предупреждением и должен быть удален перед публикацией расширения. Резервная копия сохранена в `content.js.bak`.

## Дальнейшее развитие

При разработке новых функций рекомендуется:

1. Определить, к какому компоненту относится новая функциональность
2. Добавить код в соответствующий файл
3. Если требуется создать новый компонент, добавить его в `manifest.json` в правильном порядке
4. Обновить эту документацию при значительных изменениях структуры