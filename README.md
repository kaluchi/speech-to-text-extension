# Chrome Extension для преобразования речи в текст

Расширение Chrome для записи голоса и преобразования речи в текст с помощью API ElevenLabs.

## Сервисная архитектура (PageObject Pattern)

Расширение использует паттерн PageObject для инкапсуляции взаимодействия с DOM, API браузера и другими внешними сервисами.

### Основные преимущества архитектуры:

1. **Модульность** - каждый сервис отвечает за свою область
2. **Инкапсуляция** - скрыты сложности работы с DOM и API браузера
3. **Улучшенная тестируемость** - модули можно тестировать изолированно
4. **Более чистый код** без примитивных манипуляций с DOM
5. **Легче поддерживать** - функциональность разделена на логические блоки

### Структура проекта:

```
/
├── core/                        # Ядро приложения
│   └── page-object.js           # Основной класс PageObject - координатор сервисов
├── services/                    # Сервисы, инкапсулирующие функциональность
│   ├── logger.js                # Сервис логирования
│   ├── chrome.js                # Сервис для работы с Chrome API
│   ├── settings.js              # Сервис для работы с настройками
│   ├── dom.js                   # Сервис для работы с DOM
│   ├── events.js                # Сервис для работы с событиями
│   ├── media.js                 # Сервис для работы с медиа (аудио)
│   ├── ui.js                    # Сервис для управления UI элементами
│   ├── text.js                  # Сервис для вставки текста
│   ├── clipboard.js             # Сервис для работы с буфером обмена
│   ├── notifications.js         # Сервис для уведомлений
│   ├── audio-analyzer.js        # Сервис для анализа аудио
│   ├── speech-api.js            # Сервис для работы с API распознавания речи
│   └── keyboard-controller.js   # Сервис для обработки клавиатурных событий
├── content.js                   # Точка входа для контент-скрипта
├── background.js                # Фоновый скрипт
├── popup.html/js                # Всплывающее окно расширения
├── options.html/js              # Страница настроек расширения
├── localization.js              # Модуль локализации
└── manifest.json                # Манифест расширения
```

## Основные команды

### Запись речи
Двойное нажатие клавиши Ctrl (Windows) или Command (Mac) с удержанием начинает запись. Отпускание клавиши останавливает запись.

### Настройки
В настройках расширения можно указать:
- API ключ ElevenLabs
- Язык распознавания
- Дополнительные параметры обработки речи

## Принципы работы с кодом

- Предпочтительно разделять крупные функции на более мелкие специализированные
- Каждая функция должна иметь единственную ответственность
- Минимизировать дублирование кода
- Улучшать читаемость и поддерживаемость
- Максимальный размер рефакторинга: до 100 строк кода за один раз

## Управление кодом

- Использовать git для контроля версий
- Каждое изменение оформлять отдельным коммитом с информативным сообщением
- Предпочтительный формат коммитов: "Рефакторинг: [краткое описание изменений]"

## Использование PageObject

```javascript
// В основном контент-скрипте PageObject доступен через глобальную переменную window.page
// Созданную при инициализации в content.js

// Примеры использования различных сервисов:

// Логирование
window.page.logger.info('Информационное сообщение');
window.page.logger.error('Ошибка', errorObject);

// Работа с событиями
window.page.events.onKeyDown('Control', (event, currentTime) => {
  // Обработка нажатия клавиши Control
});

// Работа с медиа
const stream = await window.page.media.getAudioStream();
const recorder = window.page.media.createRecorder(stream);
window.page.media.startRecording();

// Вставка текста
await window.page.text.insertText('Распознанный текст');

// Управление UI
window.page.ui.showMask();
window.page.ui.changeMaskColor('rgba(0, 255, 0, 0.15)');
window.page.ui.hideMask();

// Работа с настройками
const apiKey = await window.page.settings.getValue('apiKey');
await window.page.settings.checkApiKey();
```